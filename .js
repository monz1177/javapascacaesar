(function(b,f,c){"undefined"!==typeof module&&module.exports?module.exports=c(f,b):"function"===typeof define&&define.amd?define("factory",function(){return c(f,b)}):b[f]=c(f,b)})(window,"detectZoom",function(){var b=function(){return{zoom:1,devicePxPerCssPx:1}},f=function(){var b=Math.round(screen.deviceXDPI/screen.logicalXDPI*100)/100;return{zoom:b,devicePxPerCssPx:b*(window.devicePixelRatio||1)}},c=function(){var b=Math.round(document.documentElement.offsetHeight/window.innerHeight*100)/100;return{zoom:b,
devicePxPerCssPx:b*(window.devicePixelRatio||1)}},d=function(){var b=(90==Math.abs(window.orientation)?screen.height:screen.width)/window.innerWidth;return{zoom:b,devicePxPerCssPx:b*(window.devicePixelRatio||1)}},e=function(){var b=document.createElement("div");b.innerHTML="1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>0";b.setAttribute("style","font: 100px/1em sans-serif; -webkit-text-size-adjust: none; text-size-adjust: none; height: auto; width: 1em; padding: 0; overflow: visible;".replace(/;/g,
" !important;"));var c=document.createElement("div");c.setAttribute("style","width:0; height:0; overflow:hidden; visibility:hidden; position: absolute;".replace(/;/g," !important;"));c.appendChild(b);document.body.appendChild(c);b=1E3/b.clientHeight;b=Math.round(100*b)/100;document.body.removeChild(c);return{zoom:b,devicePxPerCssPx:b*(window.devicePixelRatio||1)}},g=function(){var b=k("min--moz-device-pixel-ratio","",0,10,20,1E-4);b=Math.round(100*b)/100;return{zoom:b,devicePxPerCssPx:b}},h=function(){return{zoom:g().zoom,
devicePxPerCssPx:window.devicePixelRatio||1}},p=function(){var b=window.top.outerWidth/window.top.innerWidth;b=Math.round(100*b)/100;return{zoom:b,devicePxPerCssPx:b*(window.devicePixelRatio||1)}},k=function(b,c,d,e,g,f){function h(d,e,g){var k=(d+e)/2;return 0>=g||e-d<f?k:m("("+b+":"+k+c+")").matches?h(k,e,g-1):h(d,k,g-1)}if(window.matchMedia)var m=window.matchMedia;else{var k=document.getElementsByTagName("head")[0];var r=document.createElement("style");k.appendChild(r);var n=document.createElement("div");
n.className="mediaQueryBinarySearch";n.style.display="none";document.body.appendChild(n);m=function(b){r.sheet.insertRule("@media "+b+"{.mediaQueryBinarySearch {text-decoration: underline} }",0);b="underline"==getComputedStyle(n,null).textDecoration;r.sheet.deleteRule(0);return{matches:b}}}d=h(d,e,g);n&&(k.removeChild(r),document.body.removeChild(n));return d},n=function(){var k=b;isNaN(screen.logicalXDPI)||isNaN(screen.systemXDPI)?window.navigator.msMaxTouchPoints?k=c:"orientation"in window&&"string"===
typeof document.body.style.webkitMarquee?k=d:"string"===typeof document.body.style.webkitMarquee?k=e:0<=navigator.userAgent.indexOf("Opera")?k=p:window.devicePixelRatio?k=h:.001<g().zoom&&(k=g):k=f;return k}();return{zoom:function(){return n().zoom},device:function(){return n().devicePxPerCssPx}}});
var wpcom_img_zoomer={zoomed:!1,timer:null,interval:1E3,imgNeedsSizeAtts:function(b){return null!==b.getAttribute("width")||null!==b.getAttribute("height")||b.width<b.naturalWidth||b.height<b.naturalHeight?!1:!0},updateResizeUrl:function(b,f,c){var d=b.match(/resize=([0-9%2C,]+)/);if(null===d||!d[1])return b;var e=d[1].split(","),g=null;e[0]!==f&&(g=f);e[1]!==c&&(null!==g&&(g+="%2C"),g+=c);g!==d[1]&&(b=b.replace(d[0],"resize="+g));return b},init:function(){var b=this;try{b.zoomImages(),b.timer=setInterval(function(){b.zoomImages()},
b.interval)}catch(f){}},stop:function(){this.timer&&clearInterval(this.timer)},getScale:function(){var b=detectZoom.device();3<b&&(b=Math.ceil(2*b)/2);return b},shouldZoom:function(b){return"innerWidth"in window&&!window.innerWidth||1==b&&0==this.zoomed?!1:!0},zoomImages:function(){var b=this.getScale();if(this.shouldZoom(b)){this.zoomed=!0;for(var f=document.getElementsByTagName("img"),c=0;c<f.length;c++)if(!("complete"in f[c]&&!f[c].complete||f[c].hasAttribute("srcset")&&f[c].hasAttribute("sizes")&&
"sizes"in f[c])){var d=f[c].getAttribute("scale");if(d!=b&&"0"!=d){var e=f[c].getAttribute("scale-fail");e&&e<=b||!f[c].width||!f[c].height||!d&&f[c].getAttribute("data-lazy-src")&&f[c].getAttribute("data-lazy-src")!==f[c].getAttribute("src")||(this.scaleImage(f[c],b)?f[c].setAttribute("scale",b):f[c].setAttribute("scale","0"))}}}},scaleImage:function(b,f){var c=this,d=b.src;if(b.parentNode.className.match(/slideshow-slide/))return!1;if(b.src.match(/^https?:\/\/([^\/]*\.)?gravatar\.com\/.+[?&](s|size)=/))d=
b.src.replace(/([?&](s|size)=)(\d+)/,function(d,e,g,h){d=b.getAttribute("originals");null===d&&(d=h,b.setAttribute("originals",d),c.imgNeedsSizeAtts(b)&&(b.width=b.width,b.height=b.height));h=Math.ceil(b.clientWidth*f);h=Math.max(h,d);h=Math.min(h,512);return e+h});else if(b.src.match(/^https?:\/\/([^\/]+)\.files\.wordpress\.com\/.+[?&][wh]=/)){if(b.src.match(/[?&]crop/))return!1;for(var e={},g=b.src.match(/([?&]([wh])=)(\d+)/g),h=0;h<g.length;h++){var p=g[h].split("="),k=p[0].replace(/[?&]/g,"");
p=p[1];var n="original"+k,q=b.getAttribute(n);null===q&&(q=p,b.setAttribute(n,q),c.imgNeedsSizeAtts(b)&&(b.width=b.width,b.height=b.height));n="w"==k?b.naturalWidth:b.naturalHeight;var m=Math.ceil(("w"==k?b.clientWidth:b.clientHeight)*f);m=Math.max(m,q);f>b.getAttribute("scale")&&m<=n&&(m=p);n<p&&(m=p);m!=p&&(e[k]=m)}var r=e.w||!1,t=e.h||!1;r&&(d=b.src.replace(/([?&])w=\d+/g,function(b,c){return c+"w="+r}));t&&(d=d.replace(/([?&])h=\d+/g,function(b,c){return c+"h="+t}))}else if(b.src.match(/^https?:\/\/([^\/]+\.)*(wordpress|wp)\.com\/mshots\/.+[?&]w=\d+/))d=
b.src.replace(/([?&]w=)(\d+)/,function(d,e,g){var h=b.getAttribute("originalw");null===h&&(h=g,b.setAttribute("originalw",h),c.imgNeedsSizeAtts(b)&&(b.width=b.width,b.height=b.height));var m=Math.ceil(b.clientWidth*f);m=Math.max(m,h);f>b.getAttribute("scale")&&m<=b.naturalWidth&&(m=g);return g!=m?e+m:d}),d=d.replace(/([?&]h=)(\d+)/,function(c,e,g){if(d==b.src)return c;var h=b.getAttribute("originalh");null===h&&(h=g,b.setAttribute("originalh",h));var m=Math.ceil(b.clientHeight*f);m=Math.max(m,h);
f>b.getAttribute("scale")&&m<=b.naturalHeight&&(m=g);return g!=m?e+m:c});else if(b.src.match(/^https?:\/\/([^\/.]+\.)*(wp|wordpress)\.com\/imgpress\?(.+)/)){e="zoom url h w fit filter brightness contrast colorize smooth unsharpmask".split(" ");g=RegExp.$3.split("&");for(h in g)if(h=g[h].split("=")[0],-1==e.indexOf(h))return!1;b.width=b.width;b.height=b.height;d=1==f?b.src.replace(/\?(zoom=[^&]+&)?/,"?"):b.src.replace(/\?(zoom=[^&]+&)?/,"?zoom="+f+"&")}else if(b.src.match(/^https?:\/\/([^\/.]+\.)*(wp|wordpress)\.com\/latex\.php\?(latex|zoom)=(.+)/)||
b.src.match(/^https?:\/\/i[\d]{1}\.wp\.com\/(.+)/)){if(-1<navigator.userAgent.indexOf("Firefox"))return;b.width=b.width;b.height=b.height;d=1==f?b.src.replace(/\?(zoom=[^&]+&)?/,"?"):b.src.replace(/\?(zoom=[^&]+&)?/,"?zoom="+f+"&");!b.srcset&&b.src.match(/resize/)&&(d=c.updateResizeUrl(d,b.width,b.height),b.setAttribute("srcset",d))}else if(b.src.match(/^https?:\/\/[^\/]+\/.*[-@]([12])x\.(gif|jpeg|jpg|png)(\?|$)/))b.width=b.width,b.height=b.height,g=e=RegExp.$1,g=1>=f?1:2,e!=g&&(d=b.src.replace(/([-@])[12]x\.(gif|jpeg|jpg|png)(\?|$)/,
"$1"+g+"x.$2$3"));else return!1;if(d!=b.src){e=b.getAttribute("src-orig");e||(e=b.src,b.setAttribute("src-orig",e));var x=b.src;b.onerror=function(){b.src=x;b.getAttribute("scale-fail")<f&&b.setAttribute("scale-fail",f);b.onerror=null};b.src=d}return!0}};wpcom_img_zoomer.init();function hex_md5(b){return binl2hex(core_md5(str2binl(b),b.length*chrsz))}function b64_md5(b){return binl2b64(core_md5(str2binl(b),b.length*chrsz))}function str_md5(b){return binl2str(core_md5(str2binl(b),b.length*chrsz))}function hex_hmac_md5(b,f){return binl2hex(core_hmac_md5(b,f))}function b64_hmac_md5(b,f){return binl2b64(core_hmac_md5(b,f))}function str_hmac_md5(b,f){return binl2str(core_hmac_md5(b,f))}function md5_vm_test(){return"900150983cd24fb0d6963f7d28e17f72"==hex_md5("abc")}
function core_md5(b,f){b[f>>5]|=128<<f%32;b[(f+64>>>9<<4)+14]=f;for(var c=1732584193,d=-271733879,e=-1732584194,g=271733878,h=0;h<b.length;h+=16){var p=c,k=d,n=e,q=g;c=md5_ff(c,d,e,g,b[h+0],7,-680876936);g=md5_ff(g,c,d,e,b[h+1],12,-389564586);e=md5_ff(e,g,c,d,b[h+2],17,606105819);d=md5_ff(d,e,g,c,b[h+3],22,-1044525330);c=md5_ff(c,d,e,g,b[h+4],7,-176418897);g=md5_ff(g,c,d,e,b[h+5],12,1200080426);e=md5_ff(e,g,c,d,b[h+6],17,-1473231341);d=md5_ff(d,e,g,c,b[h+7],22,-45705983);c=md5_ff(c,d,e,g,b[h+8],7,
1770035416);g=md5_ff(g,c,d,e,b[h+9],12,-1958414417);e=md5_ff(e,g,c,d,b[h+10],17,-42063);d=md5_ff(d,e,g,c,b[h+11],22,-1990404162);c=md5_ff(c,d,e,g,b[h+12],7,1804603682);g=md5_ff(g,c,d,e,b[h+13],12,-40341101);e=md5_ff(e,g,c,d,b[h+14],17,-1502002290);d=md5_ff(d,e,g,c,b[h+15],22,1236535329);c=md5_gg(c,d,e,g,b[h+1],5,-165796510);g=md5_gg(g,c,d,e,b[h+6],9,-1069501632);e=md5_gg(e,g,c,d,b[h+11],14,643717713);d=md5_gg(d,e,g,c,b[h+0],20,-373897302);c=md5_gg(c,d,e,g,b[h+5],5,-701558691);g=md5_gg(g,c,d,e,b[h+
10],9,38016083);e=md5_gg(e,g,c,d,b[h+15],14,-660478335);d=md5_gg(d,e,g,c,b[h+4],20,-405537848);c=md5_gg(c,d,e,g,b[h+9],5,568446438);g=md5_gg(g,c,d,e,b[h+14],9,-1019803690);e=md5_gg(e,g,c,d,b[h+3],14,-187363961);d=md5_gg(d,e,g,c,b[h+8],20,1163531501);c=md5_gg(c,d,e,g,b[h+13],5,-1444681467);g=md5_gg(g,c,d,e,b[h+2],9,-51403784);e=md5_gg(e,g,c,d,b[h+7],14,1735328473);d=md5_gg(d,e,g,c,b[h+12],20,-1926607734);c=md5_hh(c,d,e,g,b[h+5],4,-378558);g=md5_hh(g,c,d,e,b[h+8],11,-2022574463);e=md5_hh(e,g,c,d,b[h+
11],16,1839030562);d=md5_hh(d,e,g,c,b[h+14],23,-35309556);c=md5_hh(c,d,e,g,b[h+1],4,-1530992060);g=md5_hh(g,c,d,e,b[h+4],11,1272893353);e=md5_hh(e,g,c,d,b[h+7],16,-155497632);d=md5_hh(d,e,g,c,b[h+10],23,-1094730640);c=md5_hh(c,d,e,g,b[h+13],4,681279174);g=md5_hh(g,c,d,e,b[h+0],11,-358537222);e=md5_hh(e,g,c,d,b[h+3],16,-722521979);d=md5_hh(d,e,g,c,b[h+6],23,76029189);c=md5_hh(c,d,e,g,b[h+9],4,-640364487);g=md5_hh(g,c,d,e,b[h+12],11,-421815835);e=md5_hh(e,g,c,d,b[h+15],16,530742520);d=md5_hh(d,e,g,
c,b[h+2],23,-995338651);c=md5_ii(c,d,e,g,b[h+0],6,-198630844);g=md5_ii(g,c,d,e,b[h+7],10,1126891415);e=md5_ii(e,g,c,d,b[h+14],15,-1416354905);d=md5_ii(d,e,g,c,b[h+5],21,-57434055);c=md5_ii(c,d,e,g,b[h+12],6,1700485571);g=md5_ii(g,c,d,e,b[h+3],10,-1894986606);e=md5_ii(e,g,c,d,b[h+10],15,-1051523);d=md5_ii(d,e,g,c,b[h+1],21,-2054922799);c=md5_ii(c,d,e,g,b[h+8],6,1873313359);g=md5_ii(g,c,d,e,b[h+15],10,-30611744);e=md5_ii(e,g,c,d,b[h+6],15,-1560198380);d=md5_ii(d,e,g,c,b[h+13],21,1309151649);c=md5_ii(c,
d,e,g,b[h+4],6,-145523070);g=md5_ii(g,c,d,e,b[h+11],10,-1120210379);e=md5_ii(e,g,c,d,b[h+2],15,718787259);d=md5_ii(d,e,g,c,b[h+9],21,-343485551);c=safe_add(c,p);d=safe_add(d,k);e=safe_add(e,n);g=safe_add(g,q)}return[c,d,e,g]}function md5_cmn(b,f,c,d,e,g){return safe_add(bit_rol(safe_add(safe_add(f,b),safe_add(d,g)),e),c)}function md5_ff(b,f,c,d,e,g,h){return md5_cmn(f&c|~f&d,b,f,e,g,h)}function md5_gg(b,f,c,d,e,g,h){return md5_cmn(f&d|c&~d,b,f,e,g,h)}
function md5_hh(b,f,c,d,e,g,h){return md5_cmn(f^c^d,b,f,e,g,h)}function md5_ii(b,f,c,d,e,g,h){return md5_cmn(c^(f|~d),b,f,e,g,h)}function core_hmac_md5(b,f){var c=str2binl(b);16<c.length&&(c=core_md5(c,b.length*chrsz));for(var d=Array(16),e=Array(16),g=0;16>g;g++)d[g]=909522486^c[g],e[g]=1549556828^c[g];c=core_md5(d.concat(str2binl(f)),512+f.length*chrsz);return core_md5(e.concat(c),640)}function safe_add(b,f){var c=(65535&b)+(65535&f);return(b>>16)+(f>>16)+(c>>16)<<16|65535&c}
function bit_rol(b,f){return b<<f|b>>>32-f}function str2binl(b){for(var f=[],c=(1<<chrsz)-1,d=0;d<b.length*chrsz;d+=chrsz)f[d>>5]|=(b.charCodeAt(d/chrsz)&c)<<d%32;return f}function binl2str(b){for(var f="",c=(1<<chrsz)-1,d=0;d<32*b.length;d+=chrsz)f+=String.fromCharCode(b[d>>5]>>>d%32&c);return f}function binl2hex(b){for(var f=hexcase?"0123456789ABCDEF":"0123456789abcdef",c="",d=0;d<4*b.length;d++)c+=f.charAt(b[d>>2]>>d%4*8+4&15)+f.charAt(b[d>>2]>>d%4*8&15);return c}
function binl2b64(b){for(var f="",c=0;c<4*b.length;c+=3)for(var d=(b[c>>2]>>c%4*8&255)<<16|(b[c+1>>2]>>(c+1)%4*8&255)<<8|b[c+2>>2]>>(c+2)%4*8&255,e=0;4>e;e++)f+=8*c+6*e>32*b.length?b64pad:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d>>6*(3-e)&63);return f}"undefined"==typeof console&&(console={log:function(b){},debug:function(b){}});
var Gravatar={profile_stack:{},profile_map:{},overTimeout:!1,outTimeout:!1,stopOver:!1,active_grav:!1,active_hash:!1,active_id:!1,active_grav_clone:!1,profile_cb:null,stats_queue:[],throbber:null,has_bg:!1,disabled:!1,url_prefix:"http://en",disable:function(){Gravatar.disabled=!0;Gravatar.hide_card();var b=new Date(2100,1,1,1,1,1);Gravatar.stat("disable");-1==window.location.host.search(/wordpress.com/i)?document.cookie="nohovercard=1; expires="+b.toUTCString()+";":document.cookie="nohovercard=1; expires="+
b.toUTCString()+"; domain=.wordpress.com; path=/"},mouseOut:function(b){b.stopImmediatePropagation();Gravatar.stopOver=!0;Gravatar.outTimeout=setTimeout(function(){Gravatar.hide_card()},300)},init:function(b,f){var c,d,e=document.cookie.split(";");for(c=0;c<e.length;c++){for(d=e[c];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf("nohovercard=1"))return}"https:"==window.location.protocol&&(this.url_prefix="https://secure");this.attach_profiles(b,f);this.add_card_css();jQuery("body").on("mouseenter.gravatar mouseleave.gravatar",
"img.grav-hashed",function(b){if(!Gravatar.disabled){if(b.preventDefault(),b.stopPropagation(),"mouseleave"==b.type||"mouseout"==b.type)return Gravatar.mouseOut.call(this,b);Gravatar.stopOver=!1;Gravatar.active_id=jQuery(this).attr("id");Gravatar.active_hash=Gravatar.active_id.split("-")[1];Gravatar.untilt_gravatar();clearTimeout(Gravatar.overTimeout);!1!==Gravatar.profile_map["g"+Gravatar.active_hash]&&(Gravatar.stat("hover"),clearTimeout(Gravatar.outTimeout),Gravatar.tilt_gravatar(),Gravatar.fetch_profile_by_hash(Gravatar.active_hash,
Gravatar.active_id),Gravatar.overTimeout=setTimeout(function(){Gravatar.show_card()},600))}});jQuery("body").on("mouseenter.gravatar mouseleave.gravatar","div.gcard, img.grav-clone",function(b){Gravatar.disabled||(b.preventDefault(),b.stopPropagation(),"mouseenter"==b.type||"mouseover"==b.type?(Gravatar.stopOver=!1,clearTimeout(Gravatar.outTimeout)):Gravatar.mouseOut.call(this,b))});jQuery(window).bind("scroll",function(){Gravatar.active_hash.length&&Gravatar.hide_card()})},attach_profiles:function(b,
f){setInterval(Gravatar.send_stats,3E3);b="undefined"==typeof b?"body":b;f&&"string"==typeof f&&jQuery(f).addClass("no-grav");jQuery(b+' img[src*="gravatar.com/avatar"]').not(".no-grav, .no-grav img").each(function(){if(hash=Gravatar.extract_hash(this),uniq=0,jQuery("#grav-"+hash+"-"+uniq).length)for(;jQuery("#grav-"+hash+"-"+uniq).length;)uniq++;var b=jQuery(this).attr("id","grav-"+hash+"-"+uniq).attr("title","").removeAttr("title");b.parent("a").size()&&b.parent("a").attr("title","").removeAttr("title");
b.addClass("grav-hashed");!b.parents("#comments, .comments, #commentlist, .commentlist, .grav-hijack").size()&&b.parents("a:first").size()||b.addClass("grav-hijack")})},show_card:function(){if(!Gravatar.stopOver){if(dom_id=this.profile_map["g"+Gravatar.active_hash],jQuery(".gcard").hide(),"fetching"==this.profile_stack["g"+Gravatar.active_hash])return Gravatar.show_throbber(),this.listen(Gravatar.active_hash,"show_card"),void Gravatar.stat("wait");if("undefined"==typeof this.profile_stack["g"+Gravatar.active_hash])return Gravatar.show_throbber(),
this.listen(Gravatar.active_hash,"show_card"),void this.fetch_profile_by_hash(Gravatar.active_hash,dom_id);Gravatar.stat("show");Gravatar.hide_throbber();jQuery("#profile-"+this.active_hash).length||this.build_card(this.active_hash,this.profile_stack["g"+this.active_hash]);this.render_card(this.active_grav,"profile-"+this.active_hash)}},hide_card:function(){clearTimeout(Gravatar.overTimeout);this.untilt_gravatar();jQuery("div.gcard").filter("#profile-"+this.active_hash).fadeOut(120,function(){jQuery("img.grav-large").stop().remove()}).end().not("#profile-"+
this.active_hash).hide()},render_card:function(b,f){var c=jQuery("#"+f).stop(),d=b.offset();if(null!=d){var e=b.width(),g=b.height(),h=5+.4*e,p=c.width(),k=c.height();p==jQuery(window).width()&&(p=400,k=200);var n=d.left-17,q=d.top-7,m="pos-right";d.left+e+h+p>jQuery(window).width()+jQuery(window).scrollLeft()&&(n=d.left-p+e+17,m="pos-left");d=.25*g;jQuery("#"+f).removeClass("pos-right pos-left").addClass(m).css({top:q-d+"px",left:n+"px"});n=g/2;n>k&&(n=k/2);n>k/2-6&&(n=k/2-6);53<n&&(n=53);this.has_bg&&
(n-=8);0>n&&(n=0);g={height:2*g+d+"px"};"pos-right"==m?(g.right="auto",g.left="-7px",g["background-position"]="0px "+n+"px"):(g.right="-10px",g.left="auto",g["background-position"]="0px "+n+"px");jQuery("#"+f+" .grav-cardarrow").css(g)}c.stop().css({opacity:0}).show().animate({opacity:1},150,"linear",function(){jQuery(this).css({opacity:"auto"});jQuery(this).stop()})},build_card:function(b,f){Object.size=function(b){var c,d=0;for(c in b)b.hasOwnProperty(c)&&d++;return d};GProfile.init(f);var c=GProfile.get("urls"),
d=(GProfile.get("photos"),GProfile.get("accounts"));c=100+(3<Object.size(c)?90:10+20*Object.size(c));0<Object.size(d)&&(c+=30);d=GProfile.get("aboutMe");d=d.replace(/<[^>]+>/gi,"");d=d.toString().substr(0,c);c==d.length&&(d+='<a href="'+GProfile.get("profileUrl")+'" target="_blank">&#8230;</a>');c="grav-inner";Gravatar.my_hash&&b==Gravatar.my_hash&&(c+=" grav-is-user",d.length||(d="<p>Want a better profile? <a class='grav-edit-profile' href='http://gravatar.com/profiles/edit/?noclose' target='_blank'>Click here</a>.</p>"));
d.length&&(c+=" gcard-about");name=GProfile.get("displayName");name.length||(name=GProfile.get("preferredUsername"));d='<div id="profile-'+b+'" class="gcard grofile"> \t\t\t\t\t\t<div class="grav-inner"> \t\t\t\t\t\t\t<div class="grav-grav"> \t\t\t\t\t\t\t\t<a href="'+GProfile.get("profileUrl")+'" target="_blank"> \t\t\t\t\t\t\t\t\t<img src="'+GProfile.get("thumbnailUrl")+'?s=100&r=pg&d=mm" width="100" height="100" /> \t\t\t\t\t\t\t\t</a> \t\t\t\t\t\t\t</div> \t\t\t\t\t\t\t<div class="grav-info"> \t\t\t\t\t\t\t\t<h4><a href="'+
GProfile.get("profileUrl")+'" target="_blank">'+name+'</a></h4> \t\t\t\t\t\t\t\t<p class="grav-loc">'+GProfile.get("currentLocation")+'</p> \t\t\t\t\t\t\t\t<p class="grav-about">'+d+'</p> \t\t\t\t\t\t\t\t<div class="grav-view-complete-button"> \t\t\t\t\t\t\t\t\t<a href="'+GProfile.get("profileUrl")+'" target="_blank" class="grav-view-complete">View Complete Profile</a> \t\t\t\t\t\t\t\t</div> \t\t\t\t\t\t\t\t<p class="grav-disable"><a href="#" onclick="Gravatar.disable(); return false">Turn off hovercards</a></p> \t\t\t\t\t\t\t</div> \t\t\t\t\t\t\t<div style="clear:both"></div> \t\t\t\t\t\t</div> \t\t\t\t\t\t<div class="grav-cardarrow"></div> \t\t\t\t\t\t<div class="grav-tag"><a href="http://gravatar.com/" title="Powered by Gravatar.com" target="_blank">&nbsp;</a></div> \t\t\t\t\t</div>';
jQuery("body").append(jQuery(d));jQuery("#profile-"+b+" .grav-inner").addClass(c);this.has_bg=!1;d=GProfile.get("profileBackground");Object.size(d)&&(this.has_bg=!0,c={padding:"8px 0"},d.color&&(c["background-color"]=d.color),d.url&&(c["background-image"]="url("+d.url+")"),d.position&&(c["background-position"]=d.position),d.repeat&&(c["background-repeat"]=d.repeat),jQuery("#profile-"+b).css(c),jQuery("#profile-"+b+" .grav-tag").css("top","8px"));jQuery("#profile-"+b+" .gcard-links").length||jQuery("#profile-"+
b+" .gcard-services").length||jQuery("#profile-"+b+" .grav-rightcol").css({width:"auto"});jQuery("#profile-"+b+" .gcard-about").length||jQuery("#profile-"+b+" .grav-leftcol").css({width:"auto"});jQuery.isFunction(Gravatar.profile_cb)&&Gravatar.loaded_js(b,"profile-"+b);jQuery("#profile-"+b+" a.grav-extra-comments").click(function(b){return Gravatar.stat("click_comment",b)});jQuery("#profile-"+b+" a.grav-extra-likes").click(function(b){return Gravatar.stat("click_like",b)});jQuery("#profile-"+b+" .grav-links a").click(function(b){return Gravatar.stat("click_link",
b)});jQuery("#profile-"+b+" .grav-services a").click(function(b){return Gravatar.stat("click_service",b)});jQuery("#profile-"+b+" h4 a, #profile-"+b+" .grav-view-complete, #profile-"+b+" .grav-grav a").click(function(b){return Gravatar.stat("to_profile",b)});jQuery("#profile-"+b+" .grav-tag a").click(function(b){return 3==b.which||2==b.button||b.altKey||b.metaKey||b.ctrlKey?(b.preventDefault(),b.stopImmediatePropagation(),Gravatar.stat("egg"),Gravatar.whee()):Gravatar.stat("to_gravatar",b)}).bind("contextmenu",
function(b){return b.preventDefault(),b.stopImmediatePropagation(),Gravatar.stat("egg"),Gravatar.whee()});jQuery("#profile-"+b+" a.grav-edit-profile").click(function(b){return Gravatar.stat("click_edit_profile",b)})},tilt_gravatar:function(){if(this.active_grav=jQuery("img#"+this.active_id),!jQuery("img#grav-clone-"+this.active_hash).length){this.active_grav_clone=this.active_grav.clone().attr("id","grav-clone-"+this.active_hash).addClass("grav-clone");var b=this.active_grav.offset().top+parseInt(this.active_grav.css("padding-top"),
10),f=this.active_grav.offset().left+parseInt(this.active_grav.css("padding-left"),10),c={"-webkit-box-shadow":"0 0 4px rgba(0,0,0,.4)","-moz-box-shadow":"0 0 4px rgba(0,0,0,.4)","box-shadow":"0 0 4px rgba(0,0,0,.4)","border-width":"2px 2px "+this.active_grav.height()/5+"px 2px","border-color":"#fff","border-style":"solid",padding:"0px",margin:"-2px 0 0 -2px"},d=this.active_grav.hasClass("grav-hijack")?'<a href="http://gravatar.com/'+this.active_hash+'" class="grav-clone-a" target="_blank"></a>':
this.active_grav.parents("a:first").clone(!0).empty();b=this.active_grav_clone.css(c).wrap(d).parent().css({position:"absolute",top:b+"px",left:f+"px","z-index":15,border:"none","text-decoration":"none"});jQuery("body").append(b);this.active_grav_clone.removeClass("grav-hashed")}},untilt_gravatar:function(){jQuery("img.grav-clone, a.grav-clone-a").remove();Gravatar.hide_throbber()},show_throbber:function(){Gravatar.throbber||(Gravatar.throbber=jQuery('<div id="grav-throbber" style="position: absolute; z-index: 16"><img src="'+
this.url_prefix+'.gravatar.com/images/throbber.gif" alt="." width="15" height="15" /></div>'));jQuery("body").append(Gravatar.throbber);var b=jQuery("#"+Gravatar.active_id).offset();Gravatar.throbber.css({top:b.top+2+"px",left:b.left+1+"px"})},hide_throbber:function(){Gravatar.throbber&&Gravatar.throbber.remove()},fetch_profile_by_email:function(b){return this.fetch_profile_by_hash(this.md5(b.toString().toLowerCase()))},fetch_profile_by_hash:function(b,f){return this.profile_map["g"+b]=f,this.profile_stack["g"+
b]&&"object"==typeof this.profile_stack["g"+b]?this.profile_stack["g"+b]:(this.profile_stack["g"+b]="fetching",Gravatar.stat("fetch"),void this.load_js(this.url_prefix+".gravatar.com/"+b+".json?callback=Gravatar.fetch_profile_callback",function(){Gravatar.fetch_profile_error(b,f)}))},fetch_profile_callback:function(b){b&&"object"==typeof b&&(this.profile_stack["g"+b.entry[0].hash]=b,this.notify(b.entry[0].hash))},fetch_profile_error:function(b,f){Gravatar.stat("profile_404");Gravatar.profile_map["g"+
b]=!1;var c=jQuery("#"+f);c.parent('a[href="http://gravatar.com/'+b+'"]').size()&&c.unwrap();f==Gravatar.active_id&&Gravatar.hide_card()},listen:function(b,f){this.notify_stack||(this.notify_stack={});b="g"+b;this.notify_stack[b]||(this.notify_stack[b]=[]);for(a=0;a<this.notify_stack[b].length;a++)if(f==this.notify_stack[b][a])return;this.notify_stack[b][this.notify_stack[b].length]=f},notify:function(b){this.notify_stack||(this.notify_stack={});b="g"+b;this.notify_stack[b]||(this.notify_stack[b]=
[]);for(a=0;a<this.notify_stack[b].length;a++)0!=this.notify_stack[b][a]&&"undefined"!=typeof this.notify_stack[b][a]&&(Gravatar[this.notify_stack[b][a]](b.substr(1)),this.notify_stack[b][a]=!1)},extract_hash:function(b){if(hash=/gravatar.com\/avatar\/([0-9a-f]{32})/.exec(jQuery(b).attr("src")),null==hash||"object"!=typeof hash||2!=hash.length)if(hash=/gravatar_id=([0-9a-f]{32})/.exec(jQuery(b).attr("src")),null===hash||"object"!=typeof hash||2!=hash.length)return!1;return hash=hash[1]},load_js:function(b,
f){if(this.loaded_scripts||(this.loaded_scripts=[]),!this.loaded_scripts[b]){this.loaded_scripts[b]=!0;var c=document.createElement("script");c.src=b;c.type="text/javascript";jQuery.isFunction(f)&&(c.onerror=f);document.getElementsByTagName("head")[0].appendChild(c)}},loaded_js:function(b,f){Gravatar.profile_cb(b,f)},add_card_css:function(){if(!jQuery("#gravatar-card-css").length){var b,f=jQuery('script[src*="/js/gprofiles."]').attr("src")||!1,c=!1;(f?(b=f.replace(/\/js\/gprofiles(?:\.dev)?\.js.*$/,
""),c=f.split("?")[1]||!1):b="//s.gravatar.com",c)||(f=new Date,c=new Date(f.getFullYear(),0,1),c=Math.ceil(((f-c)/864E5+c.getDay()+1)/7),c="ver="+f.getFullYear().toString()+c.toString());b=b.replace(/^(https?:)?\/\//,"");b=window.location.protocol+"//"+b;new_css="<link rel='stylesheet' type='text/css' id='gravatar-card-css' href='"+b+"/css/hovercard.css?"+c+"' />";jQuery("#gravatar-card-services-css").length||(new_css+="<link rel='stylesheet' type='text/css' id='gravatar-card-services-css' href='"+
b+"/css/services.css?"+c+"' />");jQuery("head").append(new_css)}},md5:function(b){return hex_md5(b)},autofill:function(b,f){b.length&&-1!=b.indexOf("@")&&(this.autofill_map=f,hash=this.md5(b.toString().toLowerCase()),"undefined"==typeof this.profile_stack["g"+hash]?(this.listen(hash,"autofill_data"),this.fetch_profile_by_hash(hash)):this.autofill_data(hash))},autofill_data:function(b){GProfile.init(this.profile_stack["g"+b]);for(var f in this.autofill_map)switch(f){case "url":link=GProfile.get("urls");
url="undefined"!=typeof link[0]?link[0].value:GProfile.get("profileUrl");jQuery("#"+this.autofill_map[f]).val(url);break;case "urls":links=GProfile.get("urls");links_str="";for(l=0;l<links.length;l++)links_str+=links[l].value+"\n";jQuery("#"+this.autofill_map[f]).val(links_str);break;default:if(parts=f.split(/\./),parts[1]){switch(val=GProfile.get(f),parts[0]){case "ims":case "phoneNumbers":val=val.value;break;case "emails":val=val[0].value;case "accounts":val=val.url}jQuery("#"+this.autofill_map[f]).val(val)}else jQuery("#"+
this.autofill_map[f]).val(GProfile.get(f))}},whee:function(){if(!Gravatar.whee.didWhee){Gravatar.whee.didWhee=!0;document.styleSheets[0].addRule?document.styleSheets[0].addRule(".grav-tag a","background-position: 22px 100% !important"):jQuery(".grav-tag a").css("background-position","22px 100%");jQuery('img[src*="gravatar.com/"]').addClass("grav-whee").css({"-webkit-box-shadow":"1px 1px 3px #aaa","-moz-box-shadow":"1px 1px 3px #aaa","box-shadow":"1px 1px 3px #aaa",border:"2px white solid"});var b=
0;return setInterval(function(){jQuery(".grav-whee").css({"-webkit-transform":"rotate(-"+b+"deg) scale(1.3)","-moz-transform":"rotate(-"+b+"deg) scale(1.3)",transform:"rotate(-"+b+"deg) scale(1.3)"});b++;360==b&&(b=0)},6),!1}},stat:function(b,f){if(Gravatar.stats_queue.push(b),f){var c=f.metaKey||"_blank"==jQuery(f.currentTarget).attr("target");return Gravatar.send_stats(function(){c||(document.location=f.currentTarget.href)}),c}10<Gravatar.stats_queue.length&&Gravatar.send_stats()},send_stats:function(b){if(document.images){var f=
Gravatar.stats_queue;if(f.length){var c=new Date;Gravatar.stats_queue=[];f="https://pixel.wp.com/g.gif?v=wpcom2&x_grav-hover="+f.join(",")+"&rand="+Math.random().toString()+"-"+c.getTime();c=new Image(1,1);jQuery.isFunction(b)&&(c.onload=b);c.src=f}}}},GProfile={data:{},init:function(b){return"fetching"==b?!1:"undefined"==typeof b.entry[0]?!1:void(GProfile.data=b.entry[0])},get:function(b){if(-1!=b.indexOf(".")){if(parts=b.split(/\./),GProfile.data[parts[0]]){if(GProfile.data[parts[0]][parts[1]])return GProfile.data[parts[0]][parts[1]];
i=0;for(s=GProfile.data[parts[0]].length;i<s;i++)if(GProfile.data[parts[0]][i].type&&parts[1]==GProfile.data[parts[0]][i].type||GProfile.data[parts[0]][i].shortname&&parts[1]==GProfile.data[parts[0]][i].shortname||GProfile.data[parts[0]][i].primary&&"primary"==parts[1])return GProfile.data[parts[0]][i]}return""}return GProfile.data[b]?GProfile.data[b]:"url"==b&&GProfile.data.urls.length?GProfile.data.urls[0].value:""}},hexcase=0,b64pad="",chrsz=8;var Mustache="undefined"!==typeof module&&module.exports||{};
(function(b){function f(b){return String(b).replace(/&(?!\w+;)|[<>"']/g,function(b){return E[b]||b})}function c(b,c,d,e){e=e||"<template>";var g=c.split("\n"),f=Math.max(d-3,0);g=g.slice(f,Math.min(g.length,d+3));for(var h,m=0,k=g.length;m<k;++m)h=m+f+1,g[m]=(h===d?" >> ":"    ")+g[m];b.template=c;b.line=d;b.file=e;b.message=[e+":"+d,g.join("\n"),"",b.message].join("\n");return b}function d(b,c,d){if("."===b)return c[c.length-1];b=b.split(".");for(var e=b.length-1,g=b[e],f,m,h=c.length,k,n;h;){n=
c.slice(0);m=c[--h];for(k=0;k<e;){m=m[b[k++]];if(null==m)break;n.push(m)}if(m&&"object"===typeof m&&g in m){f=m[g];break}}"function"===typeof f&&(f=f.call(n[n.length-1]));return null==f?d:f}function e(b,c,e,g){var m="";b=d(b,c);if(g){if(null==b||!1===b||t(b)&&0===b.length)m+=e()}else if(t(b))x(b,function(b){c.push(b);m+=e();c.pop()});else if("object"===typeof b)c.push(b),m+=e(),c.pop();else if("function"===typeof b){var f=c[c.length-1];m+=b.call(f,e(),function(b){return k(b,f)})||""}else b&&(m+=e());
return m}function g(d,e){e=e||{};for(var g=e.tags||b.tags,m=g[0],f=g[g.length-1],h=['var buffer = "";',"\nvar line = 1;","\ntry {",'\nbuffer += "'],k=[],n=!1,r=!1,p=function(){if(!n||r||e.space)k=[];else for(;k.length;)h.splice(k.pop(),1);r=n=!1},t=[],q,D,x,H=function(b){g=y(b).split(/\s+/);D=g[0];x=g[g.length-1]},B=function(b){h.push('";',q,'\nvar partial = partials["'+y(b)+'"];',"\nif (partial) {","\n  buffer += render(partial,stack[stack.length - 1],partials);","\n}",'\nbuffer += "')},A=function(b,
g){var m=y(b);if(""===m)throw c(Error("Section name may not be empty"),d,z,e.file);t.push({name:m,inverted:g});h.push('";',q,'\nvar name = "'+m+'";',"\nvar callback = (function () {","\n  return function () {",'\n    var buffer = "";','\nbuffer += "')},C=function(b){A(b,!0)},E=function(b){b=y(b);var g=0!=t.length&&t[t.length-1].name;if(!g||b!=g)throw c(Error('Section named "'+b+'" was never opened'),d,z,e.file);b=t.pop();h.push('";',"\n    return buffer;","\n  };","\n})();");b.inverted?h.push("\nbuffer += renderSection(name,stack,callback,true);"):
h.push("\nbuffer += renderSection(name,stack,callback);");h.push('\nbuffer += "')},I=function(b){h.push('";',q,'\nbuffer += lookup("'+y(b)+'",stack,"");','\nbuffer += "')},J=function(b){h.push('";',q,'\nbuffer += escapeHTML(lookup("'+y(b)+'",stack,""));','\nbuffer += "')},z=1,w,v,u=0,K=d.length;u<K;++u)if(d.slice(u,u+m.length)===m){u+=m.length;w=d.substr(u,1);q="\nline = "+z+";";D=m;x=f;n=!0;switch(w){case "!":u++;v=null;break;case "=":u++;f="="+f;v=H;break;case ">":u++;v=B;break;case "#":u++;v=A;
break;case "^":u++;v=C;break;case "/":u++;v=E;break;case "{":f="}"+f;case "&":u++;r=!0;v=I;break;default:r=!0,v=J}w=d.indexOf(f,u);if(-1===w)throw c(Error('Tag "'+m+'" was not closed properly'),d,z,e.file);m=d.substring(u,w);v&&v(m);for(v=0;~(v=m.indexOf("\n",v));)z++,v++;u=w+f.length-1;m=D;f=x}else switch(w=d.substr(u,1),w){case '"':case "\\":r=!0;h.push("\\"+w);break;case "\r":break;case "\n":k.push(h.length);h.push("\\n");p();z++;break;default:F.test(w)?k.push(h.length):r=!0,h.push(w)}if(0!=t.length)throw c(Error('Section "'+
t[t.length-1].name+'" was not closed properly'),d,z,e.file);p();h.push('";',"\nreturn buffer;","\n} catch (e) { throw {error: e, line: line}; }");f=h.join("").replace(/buffer \+= "";\n/g,"");e.debug&&("undefined"!=typeof console&&console.log?console.log(f):"function"===typeof print&&print(f));return f}function h(b,m){var h=g(b,m),n=new Function("view,partials,stack,lookup,escapeHTML,renderSection,render",h);return function(g,h){h=h||{};var r=[g];try{return n(g,h,r,d,f,e,k)}catch(G){throw c(G.error,
b,G.line,m.file);}}}function p(b,c){c=c||{};return!1!==c.cache?(B[b]||(B[b]=h(b,c)),B[b]):h(b,c)}function k(b,c,d){return p(b)(c,d)}b.name="mustache.js";b.version="0.5.0-dev";b.tags=["{{","}}"];b.parse=g;b.compile=p;b.render=k;b.clearCache=function(){B={}};b.to_html=function(b,c,d,e){b=k(b,c,d);if("function"===typeof e)e(b);else return b};var n=Object.prototype.toString,q=Array.isArray,m=Array.prototype.forEach,r=String.prototype.trim;var t=q?q:function(b){return"[object Array]"===n.call(b)};var x=
m?function(b,c,d){return m.call(b,c,d)}:function(b,c,d){for(var e=0,g=b.length;e<g;++e)c.call(d,b[e],e,b)};var F=/^\s*$/;if(r)var y=function(b){return null==b?"":r.call(b)};else{if(F.test("\u00a0")){var A=/^\s+/;var C=/\s+$/}else A=/^[\s\xA0]+/,C=/[\s\xA0]+$/;y=function(b){return null==b?"":String(b).replace(A,"").replace(C,"")}}var E={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},B={}})(Mustache);var wpNotesCommon,wpNotesCommentModView,wpNoteList,wpNoteModel;
(function(b){var f=document.cookie.split(/;\s*/);for(i=0;i<f.length;i++)if(f[i].match(/^wp_api=/)){f=f[i].split("=");break}wpNotesCommon={jsonAPIbase:"https://public-api.wordpress.com/rest/v1",hasUpgradedProxy:!1,noteTypes:{comment:"comment",follow:"follow",like:["like","like_trap"],reblog:"reblog",trophy:"best_liked_day_feat like_milestone_achievement achieve_automattician_note achieve_user_anniversary best_followed_day_feat followed_milestone_achievement".split(" "),alert:["expired_domain_alert"]},
noteType2Noticon:{like:"like",follow:"follow",comment_like:"like",comment:"comment",comment_pingback:"external",reblog:"reblog",like_milestone_achievement:"trophy",achieve_followed_milestone_note:"trophy",achieve_user_anniversary:"trophy",best_liked_day_feat:"milestone",best_followed_day_feat:"milestone",automattician_achievement:"trophy",expired_domain_alert:"alert",automattcher:"atsign"},createNoteContainer:function(c,d){var e=b("<div/>",{id:d+"-note-"+c.id,"class":"wpn-note wpn-"+c.type+" "+(0<
c.unread?"wpn-unread":"wpn-read")}).data({id:parseInt(c.id,10),type:c.type}),g=b("<div/>",{"class":"wpn-note-body wpn-note-body-empty"}),h=b("<div/>",{style:"position: absolute; left: 180px; top: 60px;"});g.append(h);h.spin("medium");e.append(this.createNoteSubject(c),g);return e},createNoteSubject:function(c){return b("<div/>",{"class":"wpn-note-summary"}).append(b("<span/>",{"class":"wpn-noticon noticon noticon"+c.noticon}),b("<span/>",{"class":"wpn-icon no-grav",html:b("<img/>",{src:c.subject.icon,
width:"24px",height:"24px",style:"display: inline-block; width: 24px; height: 24px; overflow-x: hidden; overflow-y: hidden;"})}),b("<span/>",{"class":"wpn-subject",html:c.subject.html}))},createNoteBody:function(c){var d=b("<div/>",{"class":"wpn-note-body"}),e=c.toJSON(),g="wpn-"+e.body.template;switch(e.body.template){case "single-line-list":case "multi-line-list":d.append(b("<p/>").addClass(g+"-header").html(e.body.header));for(var h in e.body.items){var f=b("<div></div>",{"class":g+"-item "+g+
"-item-"+h+(e.body.items[h].icon?"":" "+g+"-item-no-icon")});e.body.items[h].icon&&f.append(b("<img/>",{"class":g+"-item-icon avatar avatar-"+e.body.items[h].icon_width,height:e.body.items[h].icon_height,width:e.body.items[h].icon_width,src:e.body.items[h].icon}));e.body.items[h].header&&f.append(b("<div></div>",{"class":g+"-item-header"}).html(e.body.items[h].header));if(e.body.items[h].action)switch(e.body.items[h].action.type){case "follow":var k=wpFollowButton.create(e.body.items[h].action);f.append(k);
k.click(function(c){b(this).children("a").hasClass("wpcom-follow-rest")?wpNotesCommon.bumpStat("notes-click-action","unfollow"):wpNotesCommon.bumpStat("notes-click-action","follow");return!0});break;default:console.error("Unsupported "+e.type+" action: "+e.body.items[h].action.type)}e.body.items[h].html&&f.append(b("<div></div>",{"class":g+"-item-body"}).html(e.body.items[h].html));d.append(f)}e.body.actions&&(c=new wpNotesCommentModView({model:c}),c.render(),d.append(c.el));e.body.footer&&d.append(b("<p/>").addClass(g+
"-footer").html(e.body.footer));break;case "big-badge":e.body.header&&d.append(b("<div/>").addClass(g+"-header").html(e.body.header));e.body.badge&&d.append(b("<div></div>",{"class":g+"-badge "}).append(e.body.badge));""!==e.body.html&&d.append(b("<div/>").addClass(g+"-footer").html(e.body.html));break;default:d.text("Unsupported note body template!")}d.find("a[notes-data-click]").mousedown(function(c){c=b(this).attr("notes-data-click");wpNotesCommon.bumpStat("notes-click-body",c);return!0});return d},
getNoteSubjects:function(b,d,e){b.fields="id,type,unread,noticon,timestamp,subject";b.trap=!0;return this.getNotes(b,d,e)},getNotes:function(b,d,e){return this.ajax({type:"GET",path:"/notifications/",data:b,success:d,error:e})},getMentions:function(b,d){return this.ajax({type:"GET",path:"/users/suggest",data:b,success:d})},markNotesSeen:function(b){return this.ajax({type:"POST",path:"/notifications/seen",data:{time:b}})},markNotesRead:function(c){var d={},e;for(e in c)0<c[e]&&(d["counts["+e+"]"]=
c[e]);return 0===d.length?(new b.Deferred).resolve("no unread notes"):this.ajax({type:"POST",path:"/notifications/read",data:d,success:function(b){},error:function(b){}})},ajax:function(c){var d=this,e={path:c.path,method:c.type};"post"==c.type.toLowerCase()?e.body=c.data:e.query=c.data;return b.Deferred(function(g){var f=function(){b.wpcom_proxy_request(e,function(b,d){if(200==d)return"function"==typeof c.success&&c.success(b),g.resolve(b);"function"==typeof c.error?c.error(d):console.error(d);return g.reject(d)})};
return d.hasUpgradedProxy?f():b.wpcom_proxy_request({metaAPI:{accessAllUsersBlogs:!0}}).done(function(){d.hasUpgradedProxy=!0;f()})})},bumpStat:function(b,d){"undefined"!=typeof wpNotesIsJetpackClient&&wpNotesIsJetpackClient&&_.contains(["notes-menu-impressions","notes-menu-clicks"],b)&&(d=d.replace(/(,|$)/g,"-jetpack$1"));(new Image).src=document.location.protocol+"//pixel.wp.com/g.gif?v=wpcom-no-pv&x_"+b+"="+d+"&baba="+Math.random()},getKeycode:function(b){b=b||window.event;b.target?element=b.target:
b.srcElement&&(element=b.srcElement);3==element.nodeType&&(element=element.parentNode);return!0===b.ctrlKey||!0===b.altKey||!0===b.metaKey?!1:(b=b.keyCode?b.keyCode:b.which)&&("INPUT"==element.tagName||"TEXTAREA"==element.tagName||"SELECT"==element.tagName)||b&&"true"==element.contentEditable?!1:b}};wpNoteModel=Backbone.Model.extend({defaults:{summary:"",unread:!0},_reloadBlocked:!1,initialize:function(){},markRead:function(){var b=this.get("unread");if(parseInt(b,10)){var d={};d[this.id]=b;wpNotesCommon.markNotesRead(d);
wpNotesCommon.bumpStat("notes-read-type",this.get("type"))}},loadBody:function(){wpNotesCommon.createNoteBody(this)},reload:function(){var c=this,d="id,type,unread,noticon,subject,body,date,timestamp,status";"comment"==c.get("type")&&(d+=",approval_status,has_replied");return!force&&this.isReloadingBlocked()?b.Deferred().reject("reloading blocked"):wpNotesCommon.getNotes({fields:d,trap:!0,ids:[c.get("id")]},function(b){b=b.notes;"undefined"!==typeof b[0]&&c.set(b[0])},function(){})},resize:function(){this.trigger("resize")},
blockReloading:function(b){var c=this;this._reloadBlocked=!0;clearTimeout(this.reloadBlockerTimeout);return this.reloadBlockerTimeout=setTimeout(function(){return c._reloadBlocked=!1},1E3*b)},isReloadingBlocked:function(){return this._reloadBlocked}});wpNoteList=Backbone.Collection.extend({model:wpNoteModel,lastMarkedSeenTimestamp:!1,newNotes:!1,maxNotes:!1,loading:!1,hasLoaded:!1,allBodiesLoaded:!1,comparator:function(b){return-b.get("timestamp")},addNotes:function(b){b=_.filter(b,function(b){return"object"===
typeof b.subject});b=_.map(b,function(b){return new wpNoteModel(b)});this.add(b);this.sort();if(this.maxNotes)for(;this.length>this.maxNotes;)this.pop();this.trigger("loadNotes:change")},getMostRecentTimestamp:function(){if(!this.length)return!1;this.sort();return parseInt(this.at(0).get("timestamp"),10)},loadNotes:function(b){var c=this;c.loading=!0;c.trigger("loadNotes:beginLoading");var e=b.fields,g=parseInt(b.number,10),f=parseInt(b.before,10),p=parseInt(b.since,10),k=parseInt(b.timeout,10)||
7E3,n="undefined"==typeof b.type?null:b.type,q="undefined"==typeof b.unread?null:b.unread;b={timeout:k};e||(e="id,type,unread,noticon,subject,body,date,timestamp,status");isNaN(g)&&(g=9);isNaN(f)||(b.before=f);isNaN(p)||(b.since=p);null!==q&&(b.unread=q);null!==n&&"unread"!=n&&"latest"!=n&&(b.type=n);b.number=g;b.fields=e;b.trap=!0;return wpNotesCommon.getNotes(b).done(function(b){var d=b.notes;var e=!1;if(!c.lastMarkedSeenTimestamp||b.last_seen_time>c.lastMarkedSeenTimestamp)e=!0,c.lastMarkedSeenTimestamp=
parseInt(b.last_seen_time,10);for(var g in d){if(b=c.get(d[g].id)){if("object"!=typeof d[g].subject){c.remove(d[g].id);e=!0;continue}n&&(e=b.get("queried_types")||{},e[n]=!0,d[g].queried_types=e);b.set(d[g])}else{if("object"!=typeof d[g].subject)continue;n&&(e={},e[n]=!0,d[g].queried_types=e);b=new wpNoteModel(d[g]);c.add(b)}b.has("body")||(c.allBodiesLoaded=!1);e=!0}if(c.maxNotes)for(;c.length>c.maxNotes;)c.pop();e&&(c.sort(),c.trigger("loadNotes:change"));c.loading=!1;c.hasLoaded=!0;c.trigger("loadNotes:endLoading")}).fail(function(b){c.loading=
!1;c.trigger("loadNotes:failed")})},loadNoteBodies:function(c){var d=this;if(d.allBodiesLoaded)return(new b.Deferred).resolve();var e=d.getNoteIds(c);if(0==e.length)return(new b.Deferred).reject();for(var g=function(b){b=b.notes;for(var c in b)if("object"==typeof b[c].subject){var e=d.get(b[c].id);e?e.set(b[c]):(e=new wpNoteModel(b[c]),d.add(e))}},f=function(b){"undefined"!=typeof console&&"function"==typeof console.error&&console.error("body loading error!")},p=[],k=0;3>k&&"undefined"!=typeof e[k];k++){var n=
{fields:"id,type,unread,noticon,timestamp,subject,body,meta,status",trap:!0};n["ids["+k+"]"]=e[k];p.push(wpNotesCommon.getNotes(n).done(g).fail(f))}if(3<e.length){n={fields:"id,type,unread,noticon,timestamp,subject,body,meta,status",trap:!0};for(k=3;k<e.length;k++)n["ids["+k+"]"]=e[k];p.push(wpNotesCommon.getNotes(n).done(g).fail(f))}e=b.when.apply(null,p);e.done(function(){"function"!=typeof c&&(d.allBodiesLoaded=!0)});return e},markNotesSeen:function(){var b=this,d=b.getMostRecentTimestamp();d>
this.lastMarkedSeenTimestamp&&wpNotesCommon.markNotesSeen(d).done(function(){b.lastMarkedSeenTimestamp=!1})},unreadCount:function(){return this.reduce(function(b,d){return b+(d.get("unread")?1:0)},0)},numberNewNotes:function(){return this.lastMarkedSeenTimestamp?this.getNewNotes().length:0},getNewNotes:function(){var b=this;return b.filter(function(c){return c.get("timestamp")>b.lastMarkedSeenTimestamp})},getUnreadNotes:function(){return this.filter(function(b){return!!parseInt(b.get("unread"),10)})},
getNotesOfType:function(b){switch(b){case "unread":return this.getUnreadNotes();case "latest":return this.filter(function(b){b=b.get("queried_types");return"undefined"!=typeof b&&"undefined"!=typeof b.latest&&b.latest});default:return this.filter(function(c){c=c.get("type");if("undefined"==typeof wpNotesCommon.noteTypes[b])return!1;if("string"==typeof wpNotesCommon.noteTypes[b])return b==c;for(var d=wpNotesCommon.noteTypes[b].length,g=0;g<d;g++)if(wpNotesCommon.noteTypes[b][g]==c)return!0;return!1})}},
getNoteIds:function(b){"function"!=typeof b&&(b=function(){return!0});return _.pluck(this.filter(b),"id")}});wpNotesCommentModView=Backbone.View.extend({mode:"buttons",actionsByName:null,possibleActions:"approve-comment replyto-comment like-comment spam-comment trash-comment unapprove-comment unlike-comment unspam-comment untrash-comment".split(" "),possibleStatuses:["approved","spam","trash","unapproved"],events:{"click .wpn-replyto-comment-button-open a":"openReply","click .wpn-comment-reply-button-close":"closeReply",
"click .wpn-comment-reply-button-send":"sendReply","click .wpn-like-comment-button a":"clickLikeComment","click .wpn-unlike-comment-button a":"clickLikeComment","click .wpn-approve-comment-button a":"clickModComment","click .wpn-unapprove-comment-button a":"clickModComment","click .wpn-spam-comment-button a":"clickModComment","click .wpn-unspam-comment-button a":"clickModComment","click .wpn-trash-comment-button a":"clickModComment","click .wpn-untrash-comment-button a":"clickModComment"},templateActions:'\t\t\t{{#reply}}\t\t\t<span class="{{reply.class}}">\t\t\t\t<a href="#" title="{{reply.title}}" data-action-type="{{reply.actionType}}">{{reply.text}}</a>\t\t\t</span>\t\t\t{{/reply}}\t\t\t{{#like}}\t\t\t<span class="{{like.class}}">\t\t\t\t<a href="#" title="{{like.title}}" data-action-type="{{like.actionType}}">{{like.text}}</a>\t\t\t</span>\t\t\t{{/like}}\t\t\t<span class="wpn-more">\t\t\t\t<a href="#">More</a>\t\t\t\t<div class="wpn-more-container">\t\t\t\t{{#spam}}\t\t\t\t<span class="{{spam.class}}">\t\t\t\t\t<a href="#" title="{{spam.title}}" data-action-type="{{spam.actionType}}">{{spam.text}}</a>\t\t\t\t</span>\t\t\t\t{{/spam}}\t\t\t\t{{#trash}}\t\t\t\t<span class="{{trash.class}}">\t\t\t\t\t<a href="#" title="{{trash.title}}" data-action-type="{{trash.actionType}}">{{trash.text}}</a>\t\t\t\t</span>\t\t\t\t{{/trash}}\t\t\t\t</div>\t\t\t</span>\t\t\t{{#approve}}\t\t\t<span class="{{approve.class}}">\t\t\t\t<a href="#" title="{{approve.title}}" data-action-type="{{approve.actionType}}">{{approve.text}}</a>\t\t\t</span>\t\t\t{{/approve}}\t\t\t<span class="wpn-comment-mod-waiting"></span>',
templateReply:'\t\t\t<div class="wpn-note-comment-reply">\t\t\t\t<h5>{{reply_header_text}}</h5>\t\t\t\t<textarea class="wpn-note-comment-reply-text" rows="5" cols="45" name="wpn-note-comment-reply-text"></textarea>\t\t\t\t<p class="wpn-comment-submit">\t\t\t\t\t<span class="wpn-comment-submit-waiting" style="display: none;"></span>\t\t\t\t<span class="wpn-comment-submit-error" style="display:none;">Error!</span>\t\t\t\t<a href="#" class="wpn-comment-reply-button-send alignright">{{submit_button_text}}</a>\t\t\t\t<a href="#" class="wpn-comment-reply-button-close alignleft">_</a>\t\t\t\t</p>\t\t\t</div>',
initialize:function(){var c=this;this.setElement(b('<div class="wpn-note-comment-actions" />'));this.listenTo(this.model,"change:status",function(b,e){var d=e.approval_status;var f=b.previous("status")||{};if((!f.approval_status||f.approval_status!==d)&&d.match(/^trash|spam$/))return c.setUndoStatus(f.approval_status)});this.listenTo(this.model,"change",this.render);b(document).on("click",".wpn-more > a",function(c){c.preventDefault();c.stopPropagation();if(!c.doneMoreToggle)return c.doneMoreToggle=
!0,b(c.currentTarget).parent().find(".wpn-more-container").toggle(),!1});this;b(document).on("click",".wpn-note-body",function(c){c=b(c.target);c.parents(".wpn-more").length||(c=c.closest(".wpn-note-body"),c.find(".wpn-more-container").is(":visible")&&c.find(".wpn-more-container").toggle())});this;b(".wpn-more-container:not(:has(*))").parents(".wpn-more").hide();b(document).on("keydown",function(b){var d;if(!c.$el.is(":hidden")&&"buttons"===c.mode&&(d=wpNotesCommon.getKeycode(b))){var g=c.getValidActions();
c.model.get("status");82===d&&_.contains(g,"replyto-comment")&&c.openReply(b);65===d&&(_.contains(g,"approve-comment")?c.modComment("approve-comment"):_.contains(g,"unapprove-comment")&&c.modComment("unapprove-comment"));76===d&&(_.contains(g,"like-comment")?c.likeComment("like-comment"):_.contains(g,"unlike-comment")&&c.likeComment("unlike-comment"));83===d&&(_.contains(g,"spam-comment")?c.modComment("spam-comment"):_.contains(g,"unspam-comment")&&c.modComment("unspam-comment"));84===d&&(_.contains(g,
"trash-comment")?c.modComment("trash-comment"):_.contains(g,"untrash-comment")&&c.modComment("untrash-comment"));return!1}});return this},render:function(){if(this.model._changing&&"reply"===this.mode)return this;this.$el.empty();if(!this.model.get("body").actions)return this;this.updateActionsMap();"buttons"===this.mode?this.$el.html(this.createActionsHTML()):(this.$el.html(this.createReplyBoxHTML()),this.$("textarea").focus());this.delegateEvents();return this},setUndoStatus:function(b){return this._undoStatus=
b},getUndoStatus:function(){if(this._undoStatus)return this._undoStatus;var b=this.model.get("status");return null!=b&&"1"===b.undo_status?"approved":"unapproved"},getValidActions:function(){var b=this.model.get("status")||{};switch(b.approval_status){case "pending":case "unapproved":return["replyto-comment","approve-comment","spam-comment","trash-comment"];case "approved":var d=["replyto-comment","unapprove-comment","spam-comment","trash-comment"];b.i_liked?d.splice(1,0,"unlike-comment"):d.splice(1,
0,"like-comment");return d;case "trash":return["untrash-comment"];case "spam":return["unspam-comment"];default:return[]}},getResultantStatus:function(b){switch(b){case "approve-comment":return"approved";case "unapprove-comment":return"unapproved";case "spam-comment":return"spam";case "trash-comment":return"trash";case "unspam-comment":case "untrash-comment":return this.getUndoStatus()}},getStatusParamFromActionType:function(b){if(b)switch(b){case "approve-comment":return"approved";case "unapprove-comment":return"unapproved";
default:return b.split("-")[0]}},getComplementaryActionType:function(b){switch(b){case "approve-comment":return"unapprove-comment";case "unapprove-comment":return"approve-comment";case "like-comment":return"unlike-comment";case "unlike-comment":return"like-comment";case "spam-comment":return"unspam-comment";case "trash-comment":return"untrash-comment";case "unspam-comment":return"spam-comment";case "untrash-comment":return"trash-comment"}},getTranslation:function(b){return"undefined"!==typeof notes_i18n&&
notes_i18n.translate?notes_i18n.translate(b).fetch():b},getTranslationsForActionType:function(b){var c=this.getTranslation;this._translationsByActionType||(this._translationsByActionType={"approve-comment":{buttonText:c("Approve"),titleText:c("Approve this comment.")},"like-comment":{buttonText:c("Like"),titleText:c("Like this comment.")},"replyto-comment":{buttonText:c("Reply"),titleText:c("Reply to this comment.")},"spam-comment":{buttonText:c("Spam"),titleText:c("Mark this comment as spam.")},
"trash-comment":{buttonText:c("Trash"),titleText:c("Move this comment to the trash.")},"unapprove-comment":{buttonText:c("Unapprove"),titleText:c("Unapprove this comment.")},"unlike-comment":{buttonText:c("Liked"),titleText:c("Unlike this comment.")},"unspam-comment":{buttonText:c("Unspam"),titleText:c("Unmark this comment as spam.")},"untrash-comment":{buttonText:c("Untrash"),titleText:c("Restore this comment from the trash.")}});return this._translationsByActionType[b]},updateActionsMap:function(){var c,
d=this;var e=this.model.get("body").actions||[];this.actionsByName=this.actionsByName||{};var g=function(c){if(c.type&&c.params)return d.actionsByName[c.type]=b.extend({},c.params,{actionType:c.type})};var f=0;for(c=e.length;f<c;f++){var p=e[f];g(p)}f=this.possibleActions;c=[];e=0;for(g=f.length;e<g;e++)p=f[e],c.push(function(c){var e=d.actionsByName[c];var g=d.getStatusParamFromActionType(c);var f=d.getTranslationsForActionType(c);e||(e=d.actionsByName[d.getComplementaryActionType(c)])&&(d.actionsByName[c]=
b.extend({},e,{actionType:c,ajax_arg:g,rest_body:{status:g},text:f.buttonText,title_text:f.titleText}));if("replyto-comment"===c)return c=d.model.get("status"),c="approved"===c.approval_status?d.getTranslation("Reply"):d.getTranslation("Approve and Reply"),b.extend(d.actionsByName["replyto-comment"],{button_text:f.buttonText,submit_button_text:c,text:f.buttonText,title_text:f.titleText})}(p));return c},createActionsHTML:function(){var c,d=this;var e=this.model.get("status").approval_status;var g=
{};var f=this.getValidActions();var p=function(c){var f;if(f=d.actionsByName[c]){var h={"class":"wpn-"+c+"-button",actionType:c,text:f.text||f.button_text};switch(c){case "replyto-comment":return g.reply=b.extend({},h,{"class":"wpn-replyto-comment-button-open",title:(f.title_text||f.button_title_text)+" [r]"});case "like-comment":case "unlike-comment":return g.like=b.extend({},h,{title:(f.title_text||f.button_title_text)+" [l]"});case "approve-comment":case "unapprove-comment":if(_.contains(["spam",
"trash"],e))break;return g.approve=b.extend({},h,{title:(f.title_text||f.button_title_text)+" [a]"});case "spam-comment":case "unspam-comment":if("trash"===e)break;return g.spam=b.extend({},h,{title:(f.title_text||f.button_title_text)+" [s]"});case "trash-comment":case "untrash-comment":if("spam"!==e)return g.trash=b.extend({},h,{title:(f.title_text||f.button_title_text)+" [t]"})}}};var k=0;for(c=f.length;k<c;k++){var n=f[k];p(n)}return Mustache.render(this.templateActions,g)},createReplyBoxHTML:function(){var b;
if(b=this.actionsByName["replyto-comment"])return Mustache.render(this.templateReply,{reply_header_text:b.reply_header_text,submit_button_text:b.submit_button_text})},closeReply:function(b){b&&b.preventDefault();this.mode="buttons";this.model.currentReplyText=this.$el.children(".wpn-note-comment-reply").children(".wpn-note-comment-reply-text").val();this.render();return this.model.resize()},openReply:function(c){var d=this;c&&c.preventDefault();this.mode="reply";this.render();this.$el.children(".wpn-note-comment-reply").children(".wpn-note-comment-reply-text").val(this.model.currentReplyText);
b(".selected .wpn-note-body p.submitconfirm").remove();this.model.resize();window.mentionDataCache||(window.mentionDataCache=[]);var e=this.actionsByName["replyto-comment"];if(null!=e.site_id){if(null!=window.mentionDataCache[e.site_id])return this.$el.children(".wpn-note-comment-reply").children(".wpn-note-comment-reply-text").mentions(window.mentionDataCache[e.site_id]);window.mentionDataCache[e.site_id]=[];c={site_id:e.site_id,client:"notes-widget"};c=wpNotesCommon.getMentions(c);return c.done(function(b){window.mentionDataCache[e.site_id]=
b.suggestions;return d.$el.children(".wpn-note-comment-reply").children(".wpn-note-comment-reply-text").mentions(window.mentionDataCache[e.site_id])})}},sendReply:function(c){var d=this;c&&c.preventDefault();c=this.actionsByName["replyto-comment"];if(!c)return b.Deferred().reject("Invalid replyto-comment action");var e=this.$el.children(".wpn-note-comment-reply");this.model.currentReplyText=e.children(".wpn-note-comment-reply-text").val();var g=c.site_id||0;var f=c.comment_id||0;var p=this.model.currentReplyText||
0;if(!(g&&f&&p))return b.Deferred().reject("Invalid sendReply params");c=e.children(".wpn-comment-submit");c.children(".wpn-comment-submit-error").hide();c.children(".wpn-comment-reply-button-send").hide();c.children(".wpn-comment-submit-waiting").gifspin("small").show();wpNotesCommon.bumpStat("notes-click-action","replyto-comment");c=function(){return wpNotesCommon.ajax({type:"POST",path:"/sites/"+g+"/comments/"+f+"/replies/new",data:{content:p},success:function(b){if("string"===typeof b)return d.errorReply(b),
!1;d.closeReply();d.model.currentReplyText="";return d.model.reload(!0).done(function(){if(!d.model.get("status").i_replied){var b=0;return d.replyCommentInterval=setInterval(function(){return d.model.reload(!0).done(function(){if(d.model.get("status").i_replied||10<=b++)return clearInterval(d.replyCommentInterval)})},3E3)}})},error:function(b){return d.errorReply(b)}}).done(function(){var c=b(".selected .wpn-comment-date a").attr("href");c='<p class="submitconfirm"><strong>'+notes_i18n.translate("Reply successful, <a %s>view thread</a>").fetch('target="_blank" href="'+
c+'"');c+="</strong></p>";return b(".selected .wpn-note-body").append(c)})};return"approved"!==this.model.get("status").approval_status?this.modComment("approve-comment").done(c):c()},errorReply:function(c){var d=c;"object"===typeof c&&(c.responseText?(d=b.parseJSON(c.responseText),d=d.error+": "+d.message):d=c.statusText?c.statusText:"Unknown Error");c=this.$el.children(".wpn-note-comment-reply");c.children(".wpn-comment-submit").children(".wpn-comment-submit-waiting").hide();if(d)return c.children(".wpn-comment-submit").children(".wpn-comment-submit-error").text(d).show()},
clickModComment:function(c){if(c)c.preventDefault();else return b.Deferred.reject("invalid click event");return this.modComment(b(c.currentTarget).data("action-type"))},modComment:function(c){var d=this;this.$(".wpn-comment-mod-waiting").show().gifspin("small");var e=b.Deferred().always(function(){return d.$(".wpn-comment-mod-waiting").empty().hide()}).fail(function(b,c){"undefined"!==typeof console&&null!==console&&"function"===typeof console.error&&(console.error("Comment moderation error"),b&&
console.error(b));if(!c||"too_soon"!==c)return d.model.reload()});if(this.modPromise&&"function"===typeof this.modPromise.state&&"pending"===this.modPromise.state())return e.always(function(){return d.$(".wpn-comment-mod-waiting").show().gifspin("small")}),e.reject("Moderation already in progress","too_soon");this.modPromise=e.promise();if(!c||!c.length||!_.contains(this.getValidActions(),c))return e.reject("Invalid actionType");b.Deferred(function(){var g;wpNotesCommon.bumpStat("notes-click-action",
c);var f=d.actionsByName[c];if(!f)return e.reject("Undefined action params for type: "+c);if(g=d.getResultantStatus(c))d.model.set("status",b.extend({},d.model.get("status"),{approval_status:g})),d.$(".wpn-comment-mod-waiting").show().gifspin("small");return wpNotesCommon.ajax({type:"POST",path:f.rest_path,data:f.rest_body}).done(function(c){c=null!=c&&c.status?c.status:"undefined";return _.contains(d.possibleStatuses,c)?(d.model.set("status",b.extend({},d.model.get("status"),{approval_status:c})),
d.model.blockReloading(15),e.resolve()):e.reject('Invalid status: "'+c+'" received from moderation POST')}).fail(function(b){return e.reject(b)})});return this.modPromise},clickLikeComment:function(c){c.preventDefault();c=b(c.currentTarget).data("action-type");return this.likeComment(c)},likeComment:function(c){var d=this;var e=this.actionsByName[c];"like-comment"===c?(c=!0,e=e.rest_path+"new/"):(c=!1,e=e.rest_path+"mine/delete/");this.model.set("status",b.extend({},this.model.get("status"),{i_liked:c}));
this.$(".wpn-comment-mod-waiting").show().gifspin("small");return wpNotesCommon.ajax({type:"POST",path:e}).done(function(b){return d.$(".wpn-comment-mod-waiting").empty().hide()})}})})(jQuery);
(function(){(function(b,f){return f.fn.gifspin=function(b){var c=f(this);if(_.isFinite(b)&&0<b)var e=Math.min(~~b,128);else switch(b){case "tiny":e=8;break;case "small":e=16;break;case "medium":e=32;break;case "large":e=64;break;default:e=128}b=f('<img class="gifspinner" src="//s0.wp.com/wp-content/mu-plugins/notes/images/loading.gif" />');b.css({height:e,width:e});c.html(b);return c}})("undefined"!==typeof exports&&null!==exports?exports:this,window.jQuery)}).call(this);"undefined"==typeof wpcom&&(wpcom={});"undefined"==typeof wpcom.events&&(wpcom.events=_.extend({},Backbone.Events));
(function(b){var f=window.wpNotesArgs||{},c=f.cacheBuster||"2.2.2-0-g7275e8f",d=f.iframeUrl||"https://widgets.wp.com/notes/",e=f.iframeAppend||"",g=f.iframeScroll||"no",h=f.wide||!1,p=f.beta||!1,k,n,q=Backbone.View.extend({el:"#wp-admin-bar-notes",hasUnseen:null,initialLoad:!0,count:null,iframe:null,iframeWindow:null,messageQ:[],iframeSpinnerShown:!1,isJetpack:!1,linkAccountsURL:!1,currentMasterbarActive:!1,initialize:function(){var c=this,d=navigator.appVersion.match(/MSIE (\d+)/);if(d&&8>parseInt(d[1],
10)){var g=c.$("#"+k),f=c.$(".ab-empty-item");g.length&&f.length&&(c.$el.offset(),c.$(".ab-item").removeClass("ab-item"),c.$("#wpnt-notes-unread-count").html("?"),g.html(' \t\t\t\t\t<div class="wpnt-notes-panel-header"><p>Notifications are not supported in this browser!</p> </div> \t\t\t\t\t<img src="http://i2.wp.com/wordpress.com/wp-content/mu-plugins/notes/images/jetpack-notes-2x.png" /> \t\t\t\t\t<p class="wpnt-ie-note"> \t\t\t\t\tPlease <a href="http://browsehappy.com" target="_blank">upgrade your browser</a> to keep using notifications. \t\t\t\t\t</p>').addClass("browse-happy"),
c.$el.on("mouseenter",function(b){clearTimeout(c.fadeOutTimeout);g.is(":visible:animated")&&g.stop().css("opacity","");f.css({"background-color":"#eee"});g.show()}),c.$el.on("mouseleave",function(){c.fadeOutTimeout=setTimeout(function(){clearTimeout(c.fadeOutTimeout);g.is(":animated")||g.fadeOut(250,function(){f.css({"background-color":"transparent"})})},350)}))}else"function"!=typeof b.fn.spin&&(b.fn.spin=function(b){}),this.isRtl=b("#wpadminbar").hasClass("rtl"),this.count=b("#wpnt-notes-unread-count"),
this.panel=b("#"+k),this.hasUnseen=this.count.hasClass("wpn-unread"),"undefined"!=typeof wpNotesIsJetpackClient&&wpNotesIsJetpackClient&&(c.isJetpack=!0),c.isJetpack&&"undefined"!=typeof wpNotesLinkAccountsURL&&(c.linkAccountsURL=wpNotesLinkAccountsURL),this.$el.children(".ab-item").on("click touchstart",function(b){b.preventDefault();c.togglePanel();return!1}),this.preventDefault=function(b){b&&b.preventDefault();return!1},"2"==e&&(this.panel.mouseenter(function(){document.body.addEventListener("mousewheel",
c.preventDefault)}),this.panel.mouseleave(function(){document.body.removeEventListener("mousewheel",c.preventDefault)}),"undefined"!==typeof document.hidden&&document.addEventListener("visibilitychange",function(){c.postMessage({action:"toggleVisibility",hidden:document.hidden})})),b(document).bind("mousedown focus",function(d){if(!c.showingPanel)return!0;d=b(d.target);if(d.is(document)||d.closest("#wp-admin-bar-notes").length)return!0;c.hidePanel();return!1}),b(document).on("keydown.notes",function(b){if(b=
wpNotesCommon.getKeycode(b))if(27==b&&c.hidePanel(),78==b&&c.togglePanel(),null!==this.iframeWindow){if(c.showingPanel&&(74==b||40==b))return c.postMessage({action:"selectNextNote"}),!1;if(c.showingPanel&&(75==b||38==b))return c.postMessage({action:"selectPrevNote"}),!1;if(c.showingPanel&&(82==b||65==b||83==b||84==b))return c.postMessage({action:"keyEvent",keyCode:b}),!1}}),wpcom.events.on("notes:togglePanel",function(){c.togglePanel()}),c.isJetpack?c.loadIframe():setTimeout(function(){c.loadIframe()},
3E3),c.count.hasClass("wpn-unread")?wpNotesCommon.bumpStat("notes-menu-impressions","non-zero"):wpNotesCommon.bumpStat("notes-menu-impressions","zero"),b(window).on("message",function(b){!b.data&&b.originalEvent.data&&(b=b.originalEvent);if("https://widgets.wp.com"==b.origin)try{var d="string"==typeof b.data?JSON.parse(b.data):b.data;"notesIframeMessage"==d.type&&c.handleEvent(d)}catch(A){}})},handleEvent:function(c){var d="undefined"!==typeof wpcomNewdash&&"undefined"!==typeof wpcomNewdash.router&&
"undefined"!==wpcomNewdash.router.setRoute;if(c&&c.action)switch(c.action){case "togglePanel":this.togglePanel();break;case "render":this.render(c.num_new,c.latest_type);break;case "renderAllSeen":this.renderAllSeen();break;case "iFrameReady":this.iFrameReady(c);break;case "goToNotesPage":d?wpcomNewdash.router.setRoute("/notifications"):window.location.href="//wordpress.com/me/notifications/";break;case "widescreen":d=b("#"+n),c.widescreen&&!d.hasClass("widescreen")?d.addClass("widescreen"):!c.widescreen&&
d.hasClass("widescreen")&&d.removeClass("widescreen")}},render:function(c,d){var e=this;if(!1!==this.hasUnseen||0!==c)if(this.initialLoad&&this.hasUnseen&&0!==c)this.initialLoad=!1;else{this.hasUnseen||0===c||wpNotesCommon.bumpStat("notes-menu-impressions","non-zero-async");var g=wpNotesCommon.noteType2Noticon[d];"undefined"==typeof g&&(g="notification");var f=b("<span/>",{"class":"noticon noticon-"+g}),h=this.getStatusIcon(c);0===c||this.showingPanel?(this.hasUnseen=!1,e.count.fadeOut(200,function(){e.count.empty();
e.count.removeClass("wpn-unread").addClass("wpn-read");e.count.html(h);e.count.fadeIn(500)}),wpcom&&wpcom.masterbar&&wpcom.masterbar.hasUnreadNotifications(!1)):(this.hasUnseen&&e.count.fadeOut(400,function(){e.count.empty();e.count.removeClass("wpn-unread").addClass("wpn-read");e.count.html(f);e.count.fadeIn(400)}),this.hasUnseen=!0,e.count.fadeOut(400,function(){e.count.empty();e.count.removeClass("wpn-read").addClass("wpn-unread");e.count.html(f);e.count.fadeIn(400,function(){})}),wpcom&&wpcom.masterbar&&
wpcom.masterbar.hasUnreadNotifications(!0))}},renderAllSeen:function(){if(this.hasToggledPanel){var b=this.getStatusIcon(0);this.count.removeClass("wpn-unread").addClass("wpn-read");this.count.empty();this.count.html(b);this.hasUnseen=!1;wpcom&&wpcom.masterbar&&wpcom.masterbar.hasUnreadNotifications(!1)}},getStatusIcon:function(c){switch(c){case 0:c="noticon noticon-notification";break;case 1:c="noticon noticon-notification";break;case 2:c="noticon noticon-notification";break;default:c="noticon noticon-notification"}return b("<span/>",
{"class":c})},togglePanel:function(){this.hasToggledPanel||(this.hasToggledPanel=!0);this.loadIframe();this.$el.toggleClass("wpnt-stayopen");this.$el.toggleClass("wpnt-show");this.showingPanel=this.$el.hasClass("wpnt-show");b(".ab-active").removeClass("ab-active");if(this.showingPanel){var c=this.$(".wpn-unread");c.length&&c.removeClass("wpn-unread").addClass("wpn-read");this.reportIframeDelay();this.hasUnseen?wpNotesCommon.bumpStat("notes-menu-clicks","non-zero"):wpNotesCommon.bumpStat("notes-menu-clicks",
"zero");this.hasUnseen=!1}this.postMessage({action:"togglePanel",showing:this.showingPanel});c=function(b){null===b.contentWindow?b.addEventListener("load",function(){b.contentWindow.focus()}):b.contentWindow.focus()};this.showingPanel?c(this.iframe[0]):window.focus();this.setActive(this.showingPanel)},setActive:function(c){c?(this.currentMasterbarActive=b(".masterbar li.active"),this.currentMasterbarActive.removeClass("active"),this.$el.addClass("active")):(this.$el.removeClass("active"),this.currentMasterbarActive.addClass("active"),
this.currentMasterbarActive=!1);this.$el.find("a").first().blur()},loadIframe:function(){var f=[];if(null===this.iframe){this.panel.addClass("loadingIframe");this.isJetpack&&(f.push("jetpack=true"),this.linkAccountsURL&&f.push("link_accounts_url="+escape(this.linkAccountsURL)));("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)&&this.panel.addClass("touch");var r="rtl"==b("#"+k).attr("dir");var t=b("#"+k).attr("lang")||"en";f.push("v="+c);f.push("locale="+t);var q=
f.length?"?"+f.join("&"):"";f=d;"2"!=e||!this.isRtl&&!r||/rtl.html$/.test(d)||(f=d+"rtl.html");f=f+q+"#"+document.location.toString();"rtl"==b("#"+k).attr("dir")&&(f+="&rtl=1");t.match(/^en/)||(f+="&lang="+t);this.iframe=b('<iframe style="display:none" id="'+n+'" frameborder=0 ALLOWTRANSPARENCY="true" scrolling="'+g+'"></iframe>');this.iframe.attr("src",f);h&&(this.panel.addClass("wide"),this.iframe.addClass("wide"));p&&this.iframe.addClass("wpnt-is-beta");this.panel.append(this.iframe)}},reportIframeDelay:function(){if(!this.iframeWindow)this.iframeSpinnerShown||
(this.iframeSpinnerShown=(new Date).getTime());else if(null!==this.iframeSpinnerShown){var b=0;this.iframeSpinnerShown&&(b=(new Date).getTime()-this.iframeSpinnerShown);0===b?wpNotesCommon.bumpStat("notes_iframe_perceived_delay","0"):1E3>b?wpNotesCommon.bumpStat("notes_iframe_perceived_delay","0-1"):2E3>b?wpNotesCommon.bumpStat("notes_iframe_perceived_delay","1-2"):4E3>b?wpNotesCommon.bumpStat("notes_iframe_perceived_delay","2-4"):8E3>b?wpNotesCommon.bumpStat("notes_iframe_perceived_delay","4-8"):
wpNotesCommon.bumpStat("notes_iframe_perceived_delay","8-N");this.iframeSpinnerShown=null}},iFrameReady:function(c){var d=this,e=document.createElement("a");e.href=this.iframe.get(0).src;this.iframeOrigin=e.protocol+"//"+e.host;this.iframeWindow=this.iframe.get(0).contentWindow;"num_new"in c&&this.render(c.num_new,c.latest_type);this.panel.removeClass("loadingIframe").find(".wpnt-notes-panel-header").remove();this.iframe.show();this.showingPanel&&this.reportIframeDelay();b(window).on("focus keydown mousemove scroll",
function(){var b=(new Date).getTime();if(!d.lastActivityRefresh||d.lastActivityRefresh<b-5E3)d.lastActivityRefresh=b,d.postMessage({action:"refreshNotes"})});this.sendQueuedMessages()},hidePanel:function(){this.showingPanel&&this.togglePanel()},postMessage:function(b){try{var c="string"==typeof b?JSON.parse(b):b;if(_.isObject(c)){c=_.extend({type:"notesIframeMessage"},c);var d=this.iframeOrigin;this.iframeWindow&&this.iframeWindow.postMessage?this.iframeWindow.postMessage(JSON.stringify(c),d):this.messageQ.push(c)}}catch(x){}},
sendQueuedMessages:function(){var b=this;_.forEach(this.messageQ,function(c){b.postMessage(c)});this.messageQ=[]}});b(function(){0==b("#wpnt-notes-panel").length&&b("#wpnt-notes-panel2").length&&"undefined"!=typeof wpNotesIsJetpackClientV2&&wpNotesIsJetpackClientV2&&(d="https://widgets.wp.com/notifications/",e="2",g="yes",h=!0);k="wpnt-notes-panel"+e;n="wpnt-notes-iframe"+e;new q})})(jQuery);